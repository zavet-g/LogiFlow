# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LogiFlow

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Å—Ç–∏–∫–∏ –¥–æ—Å—Ç–∞–≤–æ–∫ LogiFlow.

## üß™ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- **pytest** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **pytest-django** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Django
- **pytest-cov** - –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞
- **factory-boy** - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
deliveries/
‚îú‚îÄ‚îÄ test_models.py      # –¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ test_views.py       # –¢–µ—Å—Ç—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ test_serializers.py # –¢–µ—Å—Ç—ã —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ test_urls.py        # –¢–µ—Å—Ç—ã URL –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îú‚îÄ‚îÄ test_admin.py       # –¢–µ—Å—Ç—ã –∞–¥–º–∏–Ω–∫–∏
‚îî‚îÄ‚îÄ factories.py        # –§–∞–±—Ä–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
poetry run pytest

# –¢–µ—Å—Ç—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
poetry run pytest -v

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
poetry run pytest --cov=deliveries --cov-report=html

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
poetry run pytest deliveries/test_models.py::TransportModelTest::test_create_transport_model -v
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–æ–ª—å–∫–æ –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
poetry run pytest -m unit

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
poetry run pytest -m integration

# –ò—Å–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
poetry run pytest -m "not slow"

# –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
poetry run pytest deliveries/test_models.py
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Django
export DJANGO_SETTINGS_MODULE=delivery_project.test_settings

# –ó–∞–ø—É—Å–∫ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
poetry run pytest --ds=delivery_project.test_settings
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏

```bash
# HTML –æ—Ç—á–µ—Ç
poetry run pytest --cov=deliveries --cov=users --cov-report=html

# –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
poetry run pytest --cov=deliveries --cov-report=term-missing

# XML –æ—Ç—á–µ—Ç (–¥–ª—è CI/CD)
poetry run pytest --cov=deliveries --cov-report=xml
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ 80%. –ï—Å–ª–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–∏–∂–µ, —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥—É—Ç:

```bash
poetry run pytest --cov-fail-under=80
```

## üè≠ –§–∞–±—Ä–∏–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏

- `UserFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `TransportModelFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- `PackageTypeFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ —É–ø–∞–∫–æ–≤–∫–∏
- `ServiceFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥
- `DeliveryStatusFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏
- `CargoTypeFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –≥—Ä—É–∑–∞
- `DeliveryFactory` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–æ–∫

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from deliveries.factories import DeliveryFactory, UserFactory

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏
delivery = DeliveryFactory()

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
user = UserFactory(username='testuser')
delivery = DeliveryFactory(
    created_by=user,
    distance_km=100,
    tech_state='–ò—Å–ø—Ä–∞–≤–Ω–æ'
)
```

## üß© –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (`@pytest.mark.unit`)

–¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π
- –†–∞–±–æ—Ç–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
- URL –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`@pytest.mark.integration`)

–¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- –ü–æ–ª–Ω—ã–π workflow —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- API endpoints
- –ê–¥–º–∏–Ω–∫–∞ Django

### –¢–µ—Å—Ç—ã Django

- `TestCase` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- `SimpleTestCase` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `TransactionTestCase` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

### pytest.ini

```ini
[tool:pytest]
DJANGO_SETTINGS_MODULE = delivery_project.test_settings
python_files = tests.py test_*.py *_tests.py
python_classes = Test*
python_functions = test_*
addopts = 
    --strict-markers
    --strict-config
    --cov=deliveries
    --cov=users
    --cov-report=html
    --cov-report=term-missing
    --cov-fail-under=80
testpaths = 
    deliveries
    users
markers =
    slow: marks tests as slow
    integration: marks tests as integration tests
    unit: marks tests as unit tests
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Django

–§–∞–π–ª `delivery_project/test_settings.py` —Å–æ–¥–µ—Ä–∂–∏—Ç:

- SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
- –û—Ç–∫–ª—é—á–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£—Å–∫–æ—Ä–µ–Ω–Ω—ã–µ —Ö–µ—à–µ—Ä—ã –ø–∞—Ä–æ–ª–µ–π
- –û—Ç–∫–ª—é—á–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

- **–¶–µ–ª—å**: –º–∏–Ω–∏–º—É–º 80% –ø–æ–∫—Ä—ã—Ç–∏—è
- **–¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–û—Ç—á–µ—Ç—ã**: HTML, –∫–æ–Ω—Å–æ–ª—å, XML

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **–ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**: < 1 —Å–µ–∫—É–Ω–¥—ã
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**: < 5 —Å–µ–∫—É–Ω–¥
- **–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤**: < 30 —Å–µ–∫—É–Ω–¥

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

- –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ
- –ù–µ—Ç flaky —Ç–µ—Å—Ç–æ–≤
- –ß–µ—Ç–∫–∏–µ assertions –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üö® –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–ª–∞–≥–∏ pytest

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
poetry run pytest -x

# –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫
poetry run pytest -vv

# –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
poetry run pytest -l

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
poetry run pytest --pdb
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
poetry run pytest --log-cli-level=DEBUG

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª
poetry run pytest --log-file=test.log
```

## üîÑ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### GitHub Actions

```yaml
- name: Run tests
  run: |
    poetry install
    poetry run pytest --cov=deliveries --cov-report=xml
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
poetry run pytest

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
poetry run pytest --cov=deliveries --cov-fail-under=80

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞
poetry run flake8 deliveries/
```

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```python
import pytest
from django.test import TestCase
from deliveries.factories import DeliveryFactory

class DeliveryTest(TestCase):
    def test_create_delivery(self):
        """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏"""
        delivery = DeliveryFactory()
        self.assertIsNotNone(delivery.id)
        self.assertIsNotNone(delivery.transport_model)

@pytest.mark.unit
def test_delivery_str():
    """–ú–æ–¥—É–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è"""
    delivery = DeliveryFactory()
    assert str(delivery) is not None
```

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: `test_<—á—Ç–æ_—Ç–µ—Å—Ç–∏—Ä—É–µ–º>_<—É—Å–ª–æ–≤–∏–µ>`
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å docstring
3. **–ò–∑–æ–ª—è—Ü–∏—è**: —Ç–µ—Å—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
4. **–î–∞–Ω–Ω—ã–µ**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–±—Ä–∏–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **Assertions**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ—Ç–∫–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ assertions

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ >= 80%
- [ ] –ù–µ—Ç –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

**LogiFlow Testing** - –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ! üß™‚ú® 